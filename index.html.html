<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Intranet SCP – F.I.M</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; font-family: "Segoe UI", Tahoma, sans-serif; background: #0b0f14; color: #e0e0e0; }
    header { background: #111820; padding: 1rem; border-bottom: 2px solid #c62828; }
    h1 { margin: 0; font-size: 1.4rem; letter-spacing: 1px; }
    main { padding: 1.5rem; }
    .hidden { display: none; }
    .card { background: #141b24; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.6); }
    button { background: #c62828; border: none; color: white; padding: 0.6rem 1rem; border-radius: 6px; cursor: pointer; }
    input, textarea, select { width: 100%; margin-top: 0.5rem; margin-bottom: 1rem; padding: 0.5rem; background: #0b0f14; border: 1px solid #333; color: #e0e0e0; border-radius: 4px; }
    label { font-weight: bold; }
  </style>
</head>
<body>

<header>
  <h1>Fondation SCP — Intranet Forces d’Intervention Mobile</h1>
</header>

<main>

  <!-- LOGIN -->
  <div id="login" class="card">
    <h2>Authentification</h2>
    <label>Identifiant</label>
    <input id="loginUser" />
    <label>Mot de passe</label>
    <input id="loginPass" type="password" />
    <button id="loginBtn">Connexion</button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden">

    <div class="card" id="createReportCard">
      <h2>Créer un rapport</h2>
      <label>Catégorie F.I.M</label>
      <select id="unit">
        <option>NU-7</option>
        <option>E-11</option>
        <option>B-7</option>
      </select>
      <label>Titre du rapport</label>
      <input id="title" />
      <label>Contenu</label>
      <textarea id="content" rows="6"></textarea>
      <button id="saveBtn">Soumettre le rapport</button>
    </div>

    <div class="card" id="manageUsersCard" class="hidden">
      <h2>Créer / Modifier un utilisateur</h2>
      <label>Identifiant</label>
      <input id="newUser" />
      <label>Mot de passe</label>
      <input id="newPass" type="password" />
      <label>Rôle</label>
      <select id="newRole">
        <option value="user">Opérateur</option>
        <option value="admin">Commandant</option>
      </select>
      <label>Unité</label>
      <select id="newUnit">
        <option>NU-7</option>
        <option>E-11</option>
        <option>B-7</option>
        <option>ALL</option>
      </select>
      <label>Grade hiérarchique</label>
      <input id="newRank" placeholder="Ex: Caporal, Lieutenant" />
      <button id="createUserBtn">Créer / Modifier l'utilisateur</button>
    </div>

    <div class="card">
      <h2>Rapports existants</h2>
      <label>Filtrer par unité</label>
      <select id="filterUnit">
        <option value="ALL">Toutes</option>
        <option value="NU-7">NU-7</option>
        <option value="E-11">E-11</option>
        <option value="B-7">B-7</option>
      </select>
      <div id="reports"></div>
    </div>

  </div>

</main>

<script>
  const loginBox = document.getElementById("login");
  const dashboard = document.getElementById("dashboard");
  const loginUser = document.getElementById("loginUser");
  const loginPass = document.getElementById("loginPass");
  const loginBtn  = document.getElementById("loginBtn");
  const saveBtn   = document.getElementById("saveBtn");
  const unit      = document.getElementById("unit");
  const title     = document.getElementById("title");
  const content   = document.getElementById("content");
  const reportsDiv = document.getElementById("reports");
  const filterUnit = document.getElementById("filterUnit");
  const manageUsersCard = document.getElementById("manageUsersCard");
  const newUser = document.getElementById("newUser");
  const newPass = document.getElementById("newPass");
  const newRole = document.getElementById("newRole");
  const newUnit = document.getElementById("newUnit");
  const newRank = document.getElementById("newRank");
  const createUserBtn = document.getElementById("createUserBtn");

  const USERS = {
    "commandant": { password: "scp", role: "admin", unit: "ALL", rank: "Commandant" },
    "operateur": { password: "fim", role: "user", unit: "NU-7", rank: "Soldat" }
  };

  let currentUser = null;

  function handleLogin() {
    const u = loginUser.value.trim();
    const p = loginPass.value.trim();

    if (USERS[u] && USERS[u].password === p) {
      currentUser = u;
      loginBox.classList.add("hidden");

      if (USERS[currentUser].role !== "admin") {
        unit.value = USERS[currentUser].unit;
        unit.disabled = true;
      } else {
        manageUsersCard.classList.remove("hidden");
      }

      filterUnit.addEventListener("change", loadReports);
      dashboard.classList.remove("hidden");
      loadReports();
    } else {
      alert("Accès refusé — Identifiants invalides");
    }
  }

  function saveReport() {
    if (!title.value || !content.value) { alert("Titre et contenu obligatoires"); return; }
    const reports = JSON.parse(localStorage.getItem("reports") || "[]");
    reports.push({ author: currentUser, unit: unit.value, title: title.value, content: content.value, date: new Date().toLocaleString() });
    localStorage.setItem("reports", JSON.stringify(reports));
    title.value = ""; content.value = "";
    loadReports();
  }

  function loadReports() {
    const reports = JSON.parse(localStorage.getItem("reports") || "[]");
    reportsDiv.innerHTML = "";
    const userRole = USERS[currentUser].role;
    const userUnit = USERS[currentUser].unit;
    const filter = filterUnit.value;

    reports.forEach((r, idx) => {
      if (userRole !== "admin" && r.unit !== userUnit) return;
      if (filter !== "ALL" && r.unit !== filter) return;

      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <strong>[${r.unit}]</strong> ${r.title}<br>
        <small>${r.author} — ${USERS[r.author]?.rank || ''} — ${r.date}</small>
        <p>${r.content}</p>
        ${userRole === 'admin' ? `<button onclick='deleteReport(${idx})'>Supprimer</button>` : ''}
      `;
      reportsDiv.appendChild(div);
    });
  }

  function deleteReport(idx) {
    const reports = JSON.parse(localStorage.getItem("reports") || "[]");
    reports.splice(idx, 1);
    localStorage.setItem("reports", JSON.stringify(reports));
    loadReports();
  }

  function createUser() {
    const u = newUser.value.trim();
    const p = newPass.value.trim();
    const role = newRole.value;
    const unitVal = newUnit.value;
    const rankVal = newRank.value || '';

    if (!u || !p) { alert("Identifiant et mot de passe obligatoires"); return; }
    USERS[u] = { password: p, role: role, unit: unitVal, rank: rankVal };
    alert(`Utilisateur ${u} créé / modifié avec succès`);
    newUser.value = ''; newPass.value = ''; newRole.value = 'user'; newUnit.value='NU-7'; newRank.value='';
    loadReports();
  }

  loginBtn.addEventListener("click", handleLogin);
  saveBtn.addEventListener("click", saveReport);
  createUserBtn.addEventListener("click", createUser);

</script>

</body>
</html>
